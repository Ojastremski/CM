CREATE TABLE user (id INT AUTO_INCREMENT NOT NULL, username VARCHAR(32) NOT NULL, firstname VARCHAR(32) NOT NULL, lastname VARCHAR(32) NOT NULL, password VARCHAR(255) NOT NULL, email VARCHAR(64) NOT NULL, roles VARCHAR(255) NOT NULL, UNIQUE INDEX UNIQ_8D93D649F85E0677 (username), UNIQUE INDEX UNIQ_8D93D649E7927C74 (email), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB;
CREATE TABLE category (id INT AUTO_INCREMENT NOT NULL, category_name VARCHAR(20) DEFAULT NULL, active TINYINT(1) DEFAULT '1' NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB;
CREATE TABLE construction (id INT AUTO_INCREMENT NOT NULL, user_id INT DEFAULT NULL, construction_name VARCHAR(80) NOT NULL, description VARCHAR(255) DEFAULT NULL, published_at DATETIME NOT NULL, modified_at DATETIME DEFAULT NULL, note VARCHAR(100) DEFAULT NULL, note_visibility enum('main', 'subpage', 'disabled'), UNIQUE INDEX UNIQ_DC91E26E882E1656 (construction_name), INDEX IDX_DC91E26EA76ED395 (user_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB;
CREATE TABLE equipment (id INT AUTO_INCREMENT NOT NULL, category_id INT DEFAULT NULL, user_id INT DEFAULT NULL, construction_id INT DEFAULT NULL, equipment_name VARCHAR(40) NOT NULL, equipment_serial_number VARCHAR(30) DEFAULT NULL, note VARCHAR(100) DEFAULT NULL, note_visibility enum('main', 'subpage', 'disabled'), published_at DATETIME NOT NULL, modified_at DATETIME DEFAULT NULL, recipient VARCHAR(30) DEFAULT NULL, owner VARCHAR(30) DEFAULT NULL, assignment_date DATETIME DEFAULT NULL, INDEX IDX_D338D58312469DE2 (category_id), INDEX IDX_D338D583A76ED395 (user_id), INDEX IDX_D338D583CF48117A (construction_id), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB;
CREATE TABLE equipment_history (equipment_id INT NOT NULL, history_id INT NOT NULL, INDEX IDX_51C1BFA4517FE9FE (equipment_id), INDEX IDX_51C1BFA41E058452 (history_id), PRIMARY KEY(equipment_id, history_id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB;
CREATE TABLE history (id INT AUTO_INCREMENT NOT NULL, message VARCHAR(1024) NOT NULL, recipient VARCHAR(30) DEFAULT NULL, owner VARCHAR(30) DEFAULT NULL, date DATETIME NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB;
ALTER TABLE construction ADD CONSTRAINT FK_DC91E26EA76ED395 FOREIGN KEY (user_id) REFERENCES user (id) ON DELETE SET NULL;
ALTER TABLE equipment ADD CONSTRAINT FK_D338D58312469DE2 FOREIGN KEY (category_id) REFERENCES category (id) ON DELETE SET NULL;
ALTER TABLE equipment ADD CONSTRAINT FK_D338D583A76ED395 FOREIGN KEY (user_id) REFERENCES user (id) ON DELETE SET NULL;
ALTER TABLE equipment ADD CONSTRAINT FK_D338D583CF48117A FOREIGN KEY (construction_id) REFERENCES construction (id) ON DELETE SET NULL;
ALTER TABLE equipment_history ADD CONSTRAINT FK_51C1BFA4517FE9FE FOREIGN KEY (equipment_id) REFERENCES equipment (id) ON DELETE CASCADE;
ALTER TABLE equipment_history ADD CONSTRAINT FK_51C1BFA41E058452 FOREIGN KEY (history_id) REFERENCES history (id) ON DELETE CASCADE;
